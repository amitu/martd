package main

import (
	"bytes"
	"compress/gzip"
	"io/ioutil"
	"net/http"
	"os"
	"path"
	"sync"
	"time"
)

type localFS struct{}

var local localFS

type staticFS struct{}

var static staticFS

type file struct {
	compressed string
	size       int64
	local      string
	isDir      bool

	data []byte
	once sync.Once
	name string
}

func (_ localFS) Open(name string) (http.File, error) {
	f, present := data[name]
	if !present {
		return nil, os.ErrNotExist
	}
	return os.Open(f.local)
}

func (_ staticFS) Open(name string) (http.File, error) {
	f, present := data[path.Clean(name)]
	if !present {
		return nil, os.ErrNotExist
	}
	var err error
	f.once.Do(func() {
		f.name = path.Base(name)
		if f.size == 0 {
			return
		}
		var gr *gzip.Reader
		gr, err = gzip.NewReader(bytes.NewBufferString(f.compressed))
		if err != nil {
			return
		}
		f.data, err = ioutil.ReadAll(gr)
	})
	if err != nil {
		return nil, err
	}
	return f.File()
}

func (f *file) File() (http.File, error) {
	return &httpFile{
		Reader: bytes.NewReader(f.data),
		file:   f,
	}, nil
}

type httpFile struct {
	*bytes.Reader
	*file
}

func (f *file) Close() error {
	return nil
}

func (f *file) Readdir(count int) ([]os.FileInfo, error) {
	return nil, nil
}

func (f *file) Stat() (os.FileInfo, error) {
	return f, nil
}

func (f *file) Name() string {
	return f.name
}

func (f *file) Size() int64 {
	return f.size
}

func (f *file) Mode() os.FileMode {
	return 0
}

func (f *file) ModTime() time.Time {
	return time.Time{}
}

func (f *file) IsDir() bool {
	return f.isDir
}

func (f *file) Sys() interface{} {
	return f
}

// FS returns a http.Filesystem for the embedded assets. If useLocal is true,
// the filesystem's contents are instead used.
func FS(useLocal bool) http.FileSystem {
	if useLocal {
		return local
	}
	return static
}

var data = map[string]*file{

	"/client.js": {
		local:      "client.js",
		size:       1378,
		compressed: "\x1f\x8b\b\x00\x00\tn\x88\x00\xff|T[o\xf2F\x10}\x86_1\xb2*\xbcn|\x81\x8f*\x9fDn\x8aڨ\xa9Ԕ(X\nRՇ\xb5\xbd\xbe\xa4f\xd7\xd9]\a\xa2\x84\xffޝ\xb5!\x90\xb4\xe5\xc5{\x993{Ι\x19\xa2\bJ\xad\x1b5\x8b\xa2\xa2R:,*]\xb6I\x98\x8aU\xb4d\x82\xa7R(\x15}?=\x9d~\xfb>\x1d\x0e\xd7\x15\xcf\xc4:\\Q\xa9\xe1\x02\U000969fa\x12\x9cx\xf06\x1c\xbcP\t\xf4\x89n\x0e.\x80\xb4\xb2\xf6!\xa3\x9a\xfa\x90ҺNh\xfa\xb7\x0fL\xd3\xc2B,\x06\x01\x9c\xad\x89.+\x15.\xef~\xbf5t\x1e\xd8s˔\x86\xf7w\xb86\x99^\xd8r\x9e<\xb1T{Ľ[\x98\x98o60\x8e\xef\xc3i8v\xbd3\x93j\x13\x8a\x86q\x82o\xc1\x15\xb8\xf7\xf3E\xec\xc2\f\xdc_ob\xd7\a\xcbcb\x03\xab\x1c\xc8\a\x03\x83SL\xf7\xef\xdd2\x9a1I\xdc\xdf\xf2\xe0\x0f\xc1YpGuZ\xba=a\xc4n\x87\xff\x0eX\x06\xfd\x01˂G\xe3\xa0\xc1\xb8\xc7Rv$\xbfb\u007f\x16\\3\xae\x03\xfd\xda0\xc4Ѧ\xa9\xab\x94\xa2\u007f\xd1&X\xaf\xd7A.\xe4*0\n\x18OEƲ\xbd^.M\x8aW\xa5\xa9fiIy\xc1\x8e\xac\xdf\xeb\xb3Q\v\x8c\x82K\x98\xc2h\xb4/\xc5\xe1\x9a`\xa0j\x04W,f\x1b\xedæS\xbc\xa3\xcd3\xeb\xad=\x94L\xb7\x92\xc3Ƭ\xcd}W\xfa\xa2\xad2\xf3>9n\x8a\xc1\x9e\x8f\xfaiǨG\x1bs\xcb0\xaf\x85\x90\x84L\xe0\xa4\xdbKj\x1alE<\x0f~\x84\xf1f26?/\xd4b\xa1e\xc5\v29\xf5B\xd5&\xaa\xdf\xf5%\xf9 \xf4\xe9\xed\xdd1\xc1\xf5\xc0\x128\x81\xfe\xe3\x06\xee\xffm\x0e\x11G\xb7\a\x1f\x8c\xd9{\xb4\xf5\x88\xb7\xb3\xa2\x1f\x8f7<\xc7=R\xb6\xfb\xe1\x00\xaf\xc2\xd4:\x85\x86!Ɔ`\x87\x993\xc7\xc1\x1c6Ȁ\x0eG\f\v\xdc5\xa2\x99\xa4\xa4Ӈy\xffċ\xbfLd\x9a \x95\x1f\x88\x93\x88\xec\xd5\xf1B\xd3FX3缑\xec\xf2\x91V\xdaXf\xd7祼t,o3\xfb\xa9\xa9\xb7\xa8YX\x8b\x82\u0cfe%ko\x93v\xd5X~\xdb^\x16\x1e|\x99\xfa\x01\x8e<q\"\x03\xbbB*\x9c\xd5\x17i9\x19\x19\x8d\x17\x8e1j/\xf8\x04\x9cQb\x8f:\xe1>\xe4\xb4V\xcc?\xe8Xm\xfbN\xb2\xe7\xbe|\xff!\x06s`(\xa6\xfc\xa4\b%a\xbbCi\x87k\x06\xb4fR\x13\x932,\x98\xbe\xae뇾Ż\xe1SĹ\x89i\xe1x{p<\xffe>\x03\x9c\a\x91\xe7`H1)\x85Tx\xdb\xff\xf7\x99\x01\x8e\xab\x15\x13\xad&h\x88\x0f\xe3\xae\a:\xa7v-\x87\xb2φ[\xf4\xef\x9f\x00\x00\x00\xff\xff\xe0\xfc\xdb\x01b\x05\x00\x00",
	},

	"/index.html": {
		local:      "index.html",
		size:       395,
		compressed: "\x1f\x8b\b\x00\x00\tn\x88\x00\xfft\x91\xdbj\xc6 \f\x80\xaf\xbb\xa7\x10\xaf:\x18\x86^\xcf\xf5]\xac\xba\xfe\x165\xff\x9a\x14V\xc6\xde}\x1ez\xb1\x03\x03!\x1a\xbf|h\xa2o\x9c\xe2\xfc0\xe8\x9b7\xae\xc4As\xe0\xe8\xe7dvv\xc2\xf9\x84\x1az\xa60pAzAw6\x98\xec\x1e\xee,h\xb7/\x12\xc0l\xe6]\xad\x88k\xf4\xe6\x1eHYL-\a1,\x04\xdb\xdb\xe1\xf7\x13&5\x95u\x9dT\nYm$g\r]\xf5\xc7jc\xf0\x99\xffc\xeav\xa8oUt,\xa3\xb4\x93|\x12\xafG\xb6\x1c0\x8fĆ\x0fz\xfc\xa8\xcc`1\x13F\xaf\"\xae\xa3,p\xad_\xbc\x13\x8c\xa2U]\xf0s\x85?{\x00\x10M]T\xbf\xccΰ\xe9\xde\xc2\xfcT\xd7+\x81\xb9K\x1bwa]\xfa\xed\x0f\x1az\x1bK[\xdb\f\xbe\x02\x00\x00\xff\xff5Tŷ\x8b\x01\x00\x00",
	},

	"/": {
		isDir: true,
	},
}
