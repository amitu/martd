package main

import (
	"bytes"
	"compress/gzip"
	"io/ioutil"
	"net/http"
	"os"
	"path"
	"sync"
	"time"
)

type localFS struct{}

var local localFS

type staticFS struct{}

var static staticFS

type file struct {
	compressed string
	size       int64
	local      string
	isDir      bool

	data []byte
	once sync.Once
	name string
}

func (_ localFS) Open(name string) (http.File, error) {
	f, present := data[name]
	if !present {
		return nil, os.ErrNotExist
	}
	return os.Open(f.local)
}

func (_ staticFS) Open(name string) (http.File, error) {
	f, present := data[path.Clean(name)]
	if !present {
		return nil, os.ErrNotExist
	}
	var err error
	f.once.Do(func() {
		f.name = path.Base(name)
		if f.size == 0 {
			return
		}
		var gr *gzip.Reader
		gr, err = gzip.NewReader(bytes.NewBufferString(f.compressed))
		if err != nil {
			return
		}
		f.data, err = ioutil.ReadAll(gr)
	})
	if err != nil {
		return nil, err
	}
	return f.File()
}

func (f *file) File() (http.File, error) {
	return &httpFile{
		Reader: bytes.NewReader(f.data),
		file:   f,
	}, nil
}

type httpFile struct {
	*bytes.Reader
	*file
}

func (f *file) Close() error {
	return nil
}

func (f *file) Readdir(count int) ([]os.FileInfo, error) {
	return nil, nil
}

func (f *file) Stat() (os.FileInfo, error) {
	return f, nil
}

func (f *file) Name() string {
	return f.name
}

func (f *file) Size() int64 {
	return f.size
}

func (f *file) Mode() os.FileMode {
	return 0
}

func (f *file) ModTime() time.Time {
	return time.Time{}
}

func (f *file) IsDir() bool {
	return f.isDir
}

func (f *file) Sys() interface{} {
	return f
}

// FS returns a http.Filesystem for the embedded assets. If useLocal is true,
// the filesystem's contents are instead used.
func FS(useLocal bool) http.FileSystem {
	if useLocal {
		return local
	}
	return static
}

var data = map[string]*file{

	"/client.js": {
		local:      "client.js",
		size:       2097,
		compressed: "\x1f\x8b\b\x00\x00\tn\x88\x00\xff|Umo\xdb6\x10\xfel\xff\n\xce\x1f\"j\xd1K\xd2\f)\xa0\xa2+\x86\xa1X7,M1\x1bX\x80 \x1f(\x89\xb6\x95ɤFR\xb5\x83\xd6\xff}w$%K\xb6\x97\x00\xb1\xc8\xe3\xddso\x0f\x8fiJ\xd6\xc64:K\xd3U\xa5M\xb2\xaa̺͓Bn\xd2\a.E\xa1\xa4\xd6\xe9\xdb\xdbۛ7oo\xa6\xd3m%J\xb9M6L\x99\x92\xbc'\xcbV\x14\xa6\x92\x82\x86\xe4\xdbt\xf2\x95)\u009e\xd9np@h\xabꈔ̰\x88\x14\xac\xaesV\xfc\x13\x11n\xd8ʚX\x1b4\x10|Kͺ\xd2\xc9\xc3ݟ\x9f \x9e\xbf\xf8\xbf-׆|\xffN~\x01\xa4\xaf\xfc\xe1>\u007f\xe6\x85\tip7\a\x9d7Vq\xb1\xf8\x92\xdc$WA\xf8\x0e\xa0v\x89l\xb8\xa0\xe8\x8b| \xc1\x97\xfb\xf9\" \x19\t~\xfb\xb8\b\"b㸶\x8aՒ\xd0C\x04`\xa7\xb9\xf1\xfe>qVrE\x83ߗ\xf1g)x|\xc7L\xb1\x0e|\xc0h\xbb\x9f\x9e7x\x88\xbd\x80\x97\xf1\xdfPB\xb0\tƩtA\x9e\xda\xfe*\x85\xe1\xc2\xc4\xe6\xa5\xe1hǚ\xa6\xae\n\x86\xf5Kw\xf1v\xbb\x8d\x97RmbȀ\x8bB\x96\xbc\xec\xf3\x15\n ^\xb4a\x86\x17k&V|T\xfa>?\xab5G-\xf23\xb9!\x17\x17}+\x86k\x8a\x8a\xba\x91B\xf3\x05ߙ\x88\xec\\\xc6]آ\xb4\xb5\xb5B\xc5M\xab\x04\xd9\xc1\x1a\xce]\xebWm\x85\x9c\xa0cRL\xfax\xf4O]D\xde\x1a\x8a\xbbN\x96\xb5\x94\x8a\xd2kr\xe9\xf6\x8a\x01\xc364\fɏ\xe4jw}\x05\u007fab\xe4ܨJ\xac\xe8\xf5m\x98\xe86\xd7~\xe7[r\b\xe8\xc8w'\xa6\xb8\x9e\xd8\x00.\x89\xff\x04q\xf0\xdafh1:\x1d|P\xa7\xaf\xd1>\xa4aW\x8a\xee~|\xc3\x03\xbb\x81\xd2:B\x03\xd5ۺ\xee\xc5\xd86\xc1k=V.l%\xb1\xa0\x0e\xd3I!\xf1\xe1\x9dCS\xc7L\xb8Z\xf9\xe1:yHP\x1d\xbbx\xc4œ\xe7\xff\x0f^\xea\xebt\xb0\xb1ۉ`\x1b\x9eY\xa4\xc8\xee\xd1K\xe6|\xd9}\xc7\x19\x9dA\xd8(\xb1?\xe7\xfc\x01\xa4\x17\xf4\xbd\xb2d\x19e\xd8\a\x90\xf4\xc0\x8f\xa0a\x8ds<\xce\xdbM\xe3Jѵ\xd4\xc6\t:\x19B٠\n&\n^g'\x1c\x98\x94\xbc\xe6@\xfd\xf3.\xba\xe0\xe1\u007fﻇ\xceN\x86\x9b\xadڨ\x95\x1e~$KX.\x95\xa1\xfd\xa8@8\xb8\xb7\x806K\xa1}\x1f\xa0\xb1\xefg\xc0\x9e\xbeͨ\b\xb7\x9b\xd8n\x92J\x1c\xf5\xcc\xfb@\x88K\xb8Z\xb3\v4\xb6\xaa\x97d6D\x1a\xd5\xfcq\x86\x9d\x9a=\xf5a\x1cS\x10\xa7\xb4\x9b\xccKVk\x1e\r\x86\x86\x81\xab\u007f.\xb3\x03q'\x13\xa3^\\e1=\x9c\x19p\xf8\xc7\xfc\xfes\xd20\xa5\xb9\x83\xb0\x8a\xe3\xd4P\xf38\xb3\xf3\xa4I0~\x00\x1dY\f\x8e\x1c\xb8C\xafN\xa0\xbdb\xc3^j\xc9\xcaޑ\x8d\xd6\v\xff\a۟>VOރs\xf1|\xda\x18o\xd0s\xe9\xe0\xe5|B\a\xd2=?\xd1.\xb2\xce\xc9~:\xf8\xb8_\xff\xd0\xc2c\xb1\xa86\\\xb6\x86\"+#r\xe5\x8c\xf60\xb5\xe1e\x82wL\xa9\xceu\x01\x93[\xd6<\xa9\xe5\x8a\xce>*%UFf0 \x94\x8a\x88mɫ\xc08i=6\x92\x06\x97\xb0\xf0\x97ͦ\xf4n\xbaGb\xff\x17\x00\x00\xff\xff\xd72P\xf81\b\x00\x00",
	},

	"/index.html": {
		local:      "index.html",
		size:       379,
		compressed: "\x1f\x8b\b\x00\x00\tn\x88\x00\xfft\x90\xcdj\xc4 \x10\xc7\xcf٧\x90\xa1\x87\x84.ڜ\xeb\xe65z\x9e\xa8M\f~UM\xe9R\xfa\xeeU\xb3\x87\x96eA\xf8\x8f\xc3o\xbe\xfe|\xcd\xd6L\xa7\x8e\xaf\neюg\x9d\x8d\x9a,\xc6,\x89T\xd6svd\n\xc3n\x10\x9f\xbd\xbc68\x89\xa8C&)\x8a\v0\x86\x1b~\xd1\xc5\xfb\xc5(\f:Q\xe1m\xcb1\xa3\xe7Ķ\x8f]\xc5+\x1b\xe9X\xde\xedG\xadvtK0qv\xb4\xba\xeb*\x8cV.?bj\xd8=\xf5P\x17\x82\x81b\b\xca\xc9\x1ex\x88jzC\x9d\xb5[Z\xcc\xd78\xc1\xf0z\xaa\xf8'F\xb2\xa2\x93F\x91\viwҴ\xcf=\x88\x11\xce\xe4\xe5L\xdew'\xb2\xf6\xae\x97\x98q\xf8\xae%\x8fF\x00y&\x95*\x02\xff攒\x9f&\u007fv\xe6찭\xd8\xd8<\xff\r\x00\x00\xff\xff{\t.\xf9{\x01\x00\x00",
	},

	"/": {
		isDir: true,
	},
}
