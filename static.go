package main

import (
	"bytes"
	"compress/gzip"
	"io/ioutil"
	"net/http"
	"os"
	"path"
	"sync"
	"time"
)

type localFS struct{}

var local localFS

type staticFS struct{}

var static staticFS

type file struct {
	compressed string
	size       int64
	local      string
	isDir      bool

	data []byte
	once sync.Once
	name string
}

func (_ localFS) Open(name string) (http.File, error) {
	f, present := data[name]
	if !present {
		return nil, os.ErrNotExist
	}
	return os.Open(f.local)
}

func (_ staticFS) Open(name string) (http.File, error) {
	f, present := data[path.Clean(name)]
	if !present {
		return nil, os.ErrNotExist
	}
	var err error
	f.once.Do(func() {
		f.name = path.Base(name)
		if f.size == 0 {
			return
		}
		var gr *gzip.Reader
		gr, err = gzip.NewReader(bytes.NewBufferString(f.compressed))
		if err != nil {
			return
		}
		f.data, err = ioutil.ReadAll(gr)
	})
	if err != nil {
		return nil, err
	}
	return f.File()
}

func (f *file) File() (http.File, error) {
	return &httpFile{
		Reader: bytes.NewReader(f.data),
		file:   f,
	}, nil
}

type httpFile struct {
	*bytes.Reader
	*file
}

func (f *file) Close() error {
	return nil
}

func (f *file) Readdir(count int) ([]os.FileInfo, error) {
	return nil, nil
}

func (f *file) Stat() (os.FileInfo, error) {
	return f, nil
}

func (f *file) Name() string {
	return f.name
}

func (f *file) Size() int64 {
	return f.size
}

func (f *file) Mode() os.FileMode {
	return 0
}

func (f *file) ModTime() time.Time {
	return time.Time{}
}

func (f *file) IsDir() bool {
	return f.isDir
}

func (f *file) Sys() interface{} {
	return f
}

// FS returns a http.Filesystem for the embedded assets. If useLocal is true,
// the filesystem's contents are instead used.
func FS(useLocal bool) http.FileSystem {
	if useLocal {
		return local
	}
	return static
}

var data = map[string]*file{

	"/client.js": {
		local:      "client.js",
		size:       1973,
		compressed: "\x1f\x8b\b\x00\x00\tn\x88\x00\xff|Umo\xdb6\x10\xfel\xff\n\xce\x1f\"j\xb1\xa4\xa4\x19R@EW\f۰nX\xeab60\x03\x86?P\x12e˓I\x8d\xa4j\a\x8d\xff\xfb\xee(J\x96b\xaf\x01b\x89\xf7\xf2\xdcsoT\x14\x91\xad1\x95\x8e\xa3hSh\x13n\n\xb3\xad\x930\x95\xfbhɥH\x95\xd4:z\xfb\xf8\xf8\xf0\xe6\xed\xc3x|(D&\x0f\xe1\x9e)\x93\x91\xf7$\xafEj\n)\xa8O\xbe\x8eG_\x98\"lǎ=\x05\xa1\xb5*\xa7$c\x86MI\xca\xca2a\xe9?S\xc2\r\xdbX\x17\xeb\x83\x0e\x82\x1f\xa8\xd9\x16:\\>\xfd\xf9\x11\xf8\xfc\xc5\xff\xad\xb96\xe4\xe5\x85\xfc\x04H_\xf8r\x96\xecxj|\xea=\xcd\xc1\xe6\x8d5\\,>\x87\x0f\xe1\x9d\xe7\xbf\x03\xa8c(+.(\xc6\"\x1f\x88\xf7y6_x$&\xdeo\xbf.\xbc)\xb1<\xee\xada\x91\x13zf\x00~\x9a\x1b\x17\xef#g\x19W\xd4\xfb=\x0f>I\xc1\x83'fҭ\xe7\b\xa3\xefi|\xdda\x198\x01ς\xbf\xa1\x84\xe0\xe3\rSiI^\xfa\xfe,\x85\xe1\xc2\x04\xe6\xb9\xe2\xe8Ǫ\xaa,R\x86\xf5\x8b\x8e\xc1\xe1p\br\xa9\xf6\x01d\xc0E*3\x9eu\xf9\n\x05\x10\xcf\xda0\xc3\xd3-\x13\x1b>(}\x97\x9f\xb5\x9a\xa3\x15\xf9\x91<\x90\x9b\x9b\xae\x15\xfdw\x8a\x86\xba\x92B\xf3\x05?\x9a)96\x19\xb7\xb4Efkk\x85\x8a\x9bZ\tr\x84w\xd07\xad\xdf\xd4\x05\xce\x04\x1d\x0eŨ\xe3\xa3\u007fh\x199o(\xee6\xccK)\x15\xa5\xf7\xe4\xb69+\x06\x13\xb6\xa7\xbeO\xbe'w\xc7\xfb;\xf8\xf3C#\xe7F\x15bC\xef\x1f\xfdP\u05c9v'ג3\xa1W\xb1[1\xc5\xf7\x91%pK\xdc\xc3\v\xbco\x1d\xfa\x1e\x03m\xef\x816]\x8dN>\xf5\xdbR\xb4\xfb\xf1\x15\x15\xf6\x00\xa5m\x06\x1aF\xbd.\xcbN\x8cm\x13\xbc\xd4C\xe3\xd4V\x12\v\xda`6RH\xbc\xbfs\xe8\xdaL&\xacVr^'\a\t\xa6\xc3\x10+|Y\xbb\xf9\xff\xceI]\x9d\xce>\xf68\x12l\xcfc\x8b4\xb5g\x8c\x127\xb1칝\x19\x1d\x03m\x94؟k\xf1\x00\xd2\t\xba^\xd9a\x19d\xd8\x11\b;\xe0\x15XX\xe7\x04\xd5I\xbd\xaf\x9aR\xb4-\xb5<\xc1&F(K*e\"\xe5e|1\x03\xa3\x8c\x97\x1cF\xffz\x88\x96<\xfc\x9f\\\xf70\xd8\xc5\xe5f\xab6h\xa5\x83\x1f\xc8B\x96HehwU \x1c\xec-\xa0M\"h\xdf\ah\xec\xfb\tLO\xd7f4\x84\xed&\xb6\x9b\xa4\x10\xafz\xe6b \xc4-\xac\xd6\xe4\x06\x9d\xad\xe9-\x99\xf4\x91\x065_M\xb0S\x93uG\x03o\xe5\xe6&\xceY\xa9\xf9\xb4wI\x18Xu\x17\x05>\x05\x8b\xd9/\xb3\x98`ud\x9e\x13\xd0s\xa5\xa4Ҩ\xc5T\xf0~\x80\\\xfe\x98\xcf>\x85\x15S\x9a7\xee\x18f\x98\x05\x1a\xbeN\xe2\xeax\x84\xc8\x14 \a\x0e=\x95\x85n\xb0\x8b\v`gW\xb1\xe7R\xb2\xac\rc\x99:\xd9\xff ;\xed\xaaX7\xf8M\x80\xdde\xfd\x9d}72]\x8c\xebɜGk\xb7\xa6--\x17\xc2n\xc8\xe8\xbc,\xeeS\n\x9f\x83E\xb1\xe7\xb26\x14\xe7\x0e\xbeQx\xe3\xd9\xc6\xe1/\x98\xba\x81\xb7\x01ߍO8\\\xff\x05\x00\x00\xff\xff\xa4h\xc3ҵ\a\x00\x00",
	},

	"/index.html": {
		local:      "index.html",
		size:       379,
		compressed: "\x1f\x8b\b\x00\x00\tn\x88\x00\xfft\x90\xcdj\xc4 \x10\xc7\xcf٧\x90\xa1\x87\x84.ڜ\xeb\xe65z\x9e\xa8M\f~UM\xe9R\xfa\xeeU\xb3\x87\x96eA\xf8\x8f\xc3o\xbe\xfe|\xcd\xd6L\xa7\x8e\xaf\neюg\x9d\x8d\x9a,\xc6,\x89T\xd6svd\n\xc3n\x10\x9f\xbd\xbc68\x89\xa8C&)\x8a\v0\x86\x1b~\xd1\xc5\xfb\xc5(\f:Q\xe1m\xcb1\xa3\xe7Ķ\x8f]\xc5+\x1b\xe9X\xde\xedG\xadvtK0qv\xb4\xba\xeb*\x8cV.?bj\xd8=\xf5P\x17\x82\x81b\b\xca\xc9\x1ex\x88jzC\x9d\xb5[Z\xcc\xd78\xc1\xf0z\xaa\xf8'F\xb2\xa2\x93F\x91\viwҴ\xcf=\x88\x11\xce\xe4\xe5L\xdew'\xb2\xf6\xae\x97\x98q\xf8\xae%\x8fF\x00y&\x95*\x02\xff攒\x9f&\u007fv\xe6찭\xd8\xd8<\xff\r\x00\x00\xff\xff{\t.\xf9{\x01\x00\x00",
	},

	"/": {
		isDir: true,
	},
}
