package main

import (
	"bytes"
	"compress/gzip"
	"io/ioutil"
	"net/http"
	"os"
	"path"
	"sync"
	"time"
)

type localFS struct{}

var local localFS

type staticFS struct{}

var static staticFS

type file struct {
	compressed string
	size       int64
	local      string
	isDir      bool

	data []byte
	once sync.Once
	name string
}

func (_ localFS) Open(name string) (http.File, error) {
	f, present := data[name]
	if !present {
		return nil, os.ErrNotExist
	}
	return os.Open(f.local)
}

func (_ staticFS) Open(name string) (http.File, error) {
	f, present := data[path.Clean(name)]
	if !present {
		return nil, os.ErrNotExist
	}
	var err error
	f.once.Do(func() {
		f.name = path.Base(name)
		if f.size == 0 {
			return
		}
		var gr *gzip.Reader
		gr, err = gzip.NewReader(bytes.NewBufferString(f.compressed))
		if err != nil {
			return
		}
		f.data, err = ioutil.ReadAll(gr)
	})
	if err != nil {
		return nil, err
	}
	return f.File()
}

func (f *file) File() (http.File, error) {
	return &httpFile{
		Reader: bytes.NewReader(f.data),
		file:   f,
	}, nil
}

type httpFile struct {
	*bytes.Reader
	*file
}

func (f *file) Close() error {
	return nil
}

func (f *file) Readdir(count int) ([]os.FileInfo, error) {
	return nil, nil
}

func (f *file) Stat() (os.FileInfo, error) {
	return f, nil
}

func (f *file) Name() string {
	return f.name
}

func (f *file) Size() int64 {
	return f.size
}

func (f *file) Mode() os.FileMode {
	return 0
}

func (f *file) ModTime() time.Time {
	return time.Time{}
}

func (f *file) IsDir() bool {
	return f.isDir
}

func (f *file) Sys() interface{} {
	return f
}

// FS returns a http.Filesystem for the embedded assets. If useLocal is true,
// the filesystem's contents are instead used.
func FS(useLocal bool) http.FileSystem {
	if useLocal {
		return local
	}
	return static
}

var data = map[string]*file{

	"/client.js": {
		local:      "client.js",
		size:       1355,
		compressed: "\x1f\x8b\b\x00\x00\tn\x88\x00\xff|TmO\xc36\x10\xfe\xdc\xfe\x8aS4\x11g䥥\x13H\xe5MhCc\xd2X\x11\x8dD\xa5i\x1f\x9c\xc4ya\xa9\x1dl\x87\x16A\xff\xfb|NZZ\xd8\xd6/\xb1\xef\xee9?\xf7\xdc]\xa3\bJ\xad\x1b5\x8d\xa2\xa2R:,*]\xb6I\x98\x8ae\xb4`\x82\xa7R(\x15\x9d\x9d\x9eNN\xce&\xc3\xe1\xaa\xe2\x99X\x85K*5\\B\xde\xf2TW\x82\x13\x0fއ\x83W*\x81>\xd3\xf5\x9e\x03H+k\x1f2\xaa\xa9\x0f)\xad넦\u007f\xfb\xc04-,\xc4b\x10\xc0ي\xe8\xb2R\xe1\xe2\xfe\xf7;C瑽\xb4Li\xf8\xf8\x80\x1b\x93\xe9\x95-f\xc93K\xb5G\xdc\xfb\xb9\x899\xb1\x81q\xfc\x10N\u0091띛T\xebP4\x8c\x13|\v\xae\xc1}\x98\xcdc\x17\xa6\xe0\xfez\x1b\xbb>X\x1ec\x1bX\xe5@>\x19\x18\x9cb\xba\u007f\xef\x8eьI\xe2\xfe\x96\a\u007f\b\u0382{\xaa\xd3\xd2\xed\t#v3\xfcw\xc0\"\xe8\r,\v\x9e\x8c\x82\x06\xe3\x1e\x96\xb2%\xf9\x1d\xfb\xb3\xe0\x9aq\x1d跆!\x8e6M]\xa5\x14\xf5\x8b\xd6\xc1j\xb5\nr!\x97\x81\xa9\x80\xf1Td,\xdb\xd5˥I\xf1\xa64\xd5,-)/\u0601\xf4\xbb\xfal\xd4\x1c\xa3\xe0\n&pt\xb4k\xc5\xfe\x99`\xa0j\x04W,fk\xedú\xabxK\x9bgV[k\x94L\xb7\x92\xc3ڜ\x8d\xbfk}\xd1V\x99y\x9f\x1c\x0e\xc5`\xc7G\xfd\xb4eԣ\x8d\xb8e\x98\xd7BHB\xc6p\xdc\xdd%5\x03\xb6$\x9e\a?\xc2h=\x1e\x99\x9f\x17j1ײ\xe2\x05\x19\x9fz\xa1j\x13\xd5\xdf\xfa\x96|\x12\xfa\xf2\xf6\xd6L\xf0<\xb0\x04\x8e\xa1\xff\xb8\x81\xfb\u007f\x97}āw\xef\x831;\x8d6\x1e\xf1\xb6R\xf4\xeb\xf1\x8ev\xbc#e{\x1f\x0e\xd0\x15\xa6V)\x14\f16\x04'\xcc\xd8\x1c\as\xd8 \x03\xda_1lp7\x88f\x93\x92\xae>\xcc\xfb':\xfe2\x91i\x82T~ N\"\xb27\xc7\v\xcd\x18aϜ\x8bF\xb2\xab'Zi#\x99=_\x94\xf2ʱ\xbc\xcd\ue9e6ߢfa-\n\x82\xcf\xfa\x96\xac\xf5&\xed\xb2\xb1\xfc6}Yh\xf8\xb6\xf5\x03\\y\xe2D\x06v\x9d\x96\xe3\xcbё\xa9\xee\xd21\x12mK\xf5!\xa7\xb5b\xfe\xdehj;`\x92\xbd\xf4}\xfa\x0f֘\x05C\xcd\xc7\xf9B\x1d\xb9\xe3\\Ci\xb7h\n\xb4fR\x13\x932,\x98\xbe\xa9\xeb\xc7~\x96\xbb-SĹ\x8di\xe1x;p<\xfbe6\x05\x1c|\x91\xe7`H1)\x85T\xe8\xed\xff\xe4̦\xc6Ւ\x89V\x13\xac܇Q\xd7\xecN\x92\xedla\x95\xe7\xc3\r\n\xf5O\x00\x00\x00\xff\xff܍\x15\xdcK\x05\x00\x00",
	},

	"/index.html": {
		local:      "index.html",
		size:       395,
		compressed: "\x1f\x8b\b\x00\x00\tn\x88\x00\xfft\x91\xdbj\xc6 \f\x80\xaf\xbb\xa7\x10\xaf:\x18\x86^\xcf\xf5]\xac\xba\xfe\x165\xff\x9a\x14V\xc6\xde}\x1ez\xb1\x03\x03!\x1a\xbf|h\xa2o\x9c\xe2\xfc0\xe8\x9b7\xae\xc4As\xe0\xe8\xe7dvv\xc2\xf9\x84\x1az\xa60pAzAw6\x98\xec\x1e\xee,h\xb7/\x12\xc0l\xe6]\xad\x88k\xf4\xe6\x1eHYL-\a1,\x04\xdb\xdb\xe1\xf7\x13&5\x95u\x9dT\nYm$g\r]\xf5\xc7jc\xf0\x99\xffc\xeav\xa8oUt,\xa3\xb4\x93|\x12\xafG\xb6\x1c0\x8fĆ\x0fz\xfc\xa8\xcc`1\x13F\xaf\"\xae\xa3,p\xad_\xbc\x13\x8c\xa2U]\xf0s\x85?{\x00\x10M]T\xbf\xccΰ\xe9\xde\xc2\xfcT\xd7+\x81\xb9K\x1bwa]\xfa\xed\x0f\x1az\x1bK[\xdb\f\xbe\x02\x00\x00\xff\xff5Tŷ\x8b\x01\x00\x00",
	},

	"/": {
		isDir: true,
	},
}
